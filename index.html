<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Noise Seamless Procedural Clouds</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>html, body { margin: 0; height: 100%; overflow: hidden; }</style>
</head>
<body>
  <script>
    AFRAME.registerShader('seamless-clouds-3d', {
      schema: {
        time: { type: 'time', is: 'uniform' }
      },
      vertexShader: `
        varying vec3 vWorldDirection;
        void main() {
          vec4 worldPosition = modelMatrix * vec4(position, 1.0);
          vWorldDirection = normalize(worldPosition.xyz - cameraPosition);
          gl_Position = projectionMatrix * viewMatrix * worldPosition;
        }
      `,
      fragmentShader: `
        #ifdef GL_ES
        precision highp float;
        #endif

        uniform float time;
        varying vec3 vWorldDirection;

        float hash3(vec3 p) {
          p = fract(p * 0.3183099 + vec3(0.1, 0.1, 0.1));
          p *= 17.0;
          return fract(p.x * p.y * p.z * (p.x + p.y + p.z));
        }

        float noise3(vec3 p) {
          vec3 i = floor(p);
          vec3 f = fract(p);
          vec3 u = f * f * (3.0 - 2.0 * f);

          float n000 = hash3(i + vec3(0.0, 0.0, 0.0));
          float n100 = hash3(i + vec3(1.0, 0.0, 0.0));
          float n010 = hash3(i + vec3(0.0, 1.0, 0.0));
          float n110 = hash3(i + vec3(1.0, 1.0, 0.0));
          float n001 = hash3(i + vec3(0.0, 0.0, 1.0));
          float n101 = hash3(i + vec3(1.0, 0.0, 1.0));
          float n011 = hash3(i + vec3(0.0, 1.0, 1.0));
          float n111 = hash3(i + vec3(1.0, 1.0, 1.0));

          float nx00 = mix(n000, n100, u.x);
          float nx10 = mix(n010, n110, u.x);
          float nx01 = mix(n001, n101, u.x);
          float nx11 = mix(n011, n111, u.x);

          float nxy0 = mix(nx00, nx10, u.y);
          float nxy1 = mix(nx01, nx11, u.y);

          return mix(nxy0, nxy1, u.z);
        }

        float fbm3(vec3 p) {
          float value = 0.0;
          float amplitude = 0.5;
          float frequency = 1.0;
          for (int i=0; i<5; i++) {
            value += amplitude * noise3(p * frequency);
            frequency *= 2.0;
            amplitude *= 0.5;
          }
          return value;
        }

        void main() {
          vec3 dir = normalize(vWorldDirection);

          // Scale controls cloud detail
          float scale = 2.0;
          float speed = 0.001;

          // Animate by moving noise sample position over time
          vec3 pos = dir * scale + vec3(time * speed, time * speed * 0.5, time * speed * 0.25);

          float clouds = fbm3(pos);

          vec3 baseColor = vec3(0.1, 0.2, 0.5);
          vec3 cloudColor = vec3(1.0);

          // Mix clouds with base sky color
          vec3 color = mix(baseColor, cloudColor, clouds);

          gl_FragColor = vec4(color, 1.0);
        }
      `
    });
  </script>

  <a-scene renderer="precision: highp;" background="color: black">
    <a-entity geometry="primitive: sphere; radius: 5000; segmentsWidth: 128; segmentsHeight: 128"
              material="shader: seamless-clouds-3d; side: back;"
              scale="-1 1 1">
    </a-entity>
    <a-entity camera position="0 1.6 0" look-controls wasd-controls></a-entity>
  </a-scene>
</body>
</html>
